<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Troubleshooting &#8212; RktMachine</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/woofwoofinc.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="Working with rkt" href="rkt.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          RktMachine</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#installing-rktmachine">Installing RktMachine</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#starting-the-rktmachine-coreos-vm">Starting the RktMachine CoreOS VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#building-a-rkt-container">Building a rkt Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#installing-and-running-rkt-containers">Installing and Running rkt Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#running-rkt-containers-interactively">Running rkt Containers Interactively</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rkt.html">Working with rkt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rkt.html#building-containers-for-rkt">Building Containers for rkt</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#coreos-vm-does-not-boot">CoreOS VM Does Not Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nfs-mount-unavailable">NFS Mount Unavailable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nfs-mount-not-writable">NFS Mount Not Writable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reclaiming-vm-root-disk-image-space">Reclaiming VM Root Disk Image Space</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-coreos">Why CoreOS?</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Development Tools Container</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev.html#building">Building</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building</a><ul>
<li class="toctree-l2"><a class="reference internal" href="building.html#xcode">XCode</a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html#rebuilding-root-qcow2">Rebuilding <code class="docutils literal notranslate"><span class="pre">root.qcow2</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html#rebuilding-tools-qcow2">Rebuilding <code class="docutils literal notranslate"><span class="pre">tools.qcow2</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html#rebuilding-macos-corectl-binaries">Rebuilding macOS Corectl Binaries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="releasing.html#release-checklist">Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="releasing.html#building-a-release-dmg">Building a Release DMG</a></li>
<li class="toctree-l2"><a class="reference internal" href="releasing.html#preparing-the-github-release">Preparing the GitHub Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="releasing.html#publishing-the-documentation">Publishing the Documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="conduct.html">Contributor Covenant Code of Conduct</a><ul>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#our-pledge">Our Pledge</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#our-standards">Our Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#our-responsibilities">Our Responsibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#scope">Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#enforcement">Enforcement</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#attribution">Attribution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="thanks.html">Thanks</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="rkt.html" title="Previous Chapter: Working with rkt"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Working with rkt</span>
    </a>
  </li>
  <li>
    <a href="faq.html" title="Next Chapter: Frequently Asked Questions"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Frequently As... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="coreos-vm-does-not-boot">
<h2>CoreOS VM Does Not Boot<a class="headerlink" href="#coreos-vm-does-not-boot" title="Permalink to this headline">¶</a></h2>
<p>A failure to boot the CoreOS VM usually appears as a message in the start
terminal saying the VM IP address cannot be determined.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">booting</span> <span class="n">rktmachine</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="n">ERROR</span><span class="p">]</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">grab</span> <span class="n">VM</span><span class="s1">&#39;s IP after 30s (!)... Aborted</span>

<span class="n">Press</span> <span class="p">[</span><span class="n">Enter</span><span class="p">]</span> <span class="n">to</span> <span class="k">continue</span><span class="o">.</span>
</pre></div>
</div>
<p>First try the troubleshooting advice from <a class="reference external" href="https://github.com/TheNewNormal/corectl">Corectl</a>.</p>
<ul class="simple">
<li>Check your macOS machine is running Yosemite 10.10.3 or later.</li>
<li>The macOS machine must also be a 2010 or later model so that the CPU supports
the <a class="reference external" href="https://en.wikipedia.org/wiki/Second_Level_Address_Translation#EPT">EPT</a> extensions.</li>
<li>VirtualBox not installed or newer than version 4.3.30. This is incompatible
with the <a class="reference external" href="https://github.com/mist64/xhyve">xhyve</a> underlying Hypervisor and can cause a kernel panic if run
simultaneously with an old VirtualBox or if the VirtualBox has been run since
the last reboot.</li>
<li>Ensure any running desktop firewalls, e.g. ESET, Little Snitch, are not
disallowing traffic from/to the <code class="docutils literal notranslate"><span class="pre">bridge100</span></code> interface used by the CoreOS
VM. This will prevent the VM from booting since it will not be able to fetch
cloud-init or other configuration data from the host machine.</li>
</ul>
<p>Otherwise, look in the <code class="docutils literal notranslate"><span class="pre">~/.coreos</span></code> directory for VM boot log files. For
RktMachine, they will be in
<code class="docutils literal notranslate"><span class="pre">~/.coreos/running/C16CF576-FB07-4DC9-8BF6-C022445B31A8/log</span></code>. This file
will contain error messaging for boot failures on the VM.</p>
<p>To try a complete reset, make sure to delete <code class="docutils literal notranslate"><span class="pre">~/.rktmachine</span></code>, remove the
RktMachine application, and to reboot the host macOS machine to reset any
issues in virtualisation.</p>
</div>
<div class="section" id="nfs-mount-unavailable">
<h2>NFS Mount Unavailable<a class="headerlink" href="#nfs-mount-unavailable" title="Permalink to this headline">¶</a></h2>
<p>The NFS <code class="docutils literal notranslate"><span class="pre">/Users</span></code> directory is loaded late on VM boot. So if you have SSH-ed
to the instance immediately on boot then the directory may be unavailable until
the later boot sequence services are started.</p>
<p>The NFS mount will become available after a few moments when the boot has
completed.</p>
<p>This is particularly noticeable if you create convenience symlinks from the
home directory in the CoreOS VM to checked out development repositories in the
NFS mount. These are useful to switch quickly to working off locations on the
host drive.</p>
</div>
<div class="section" id="nfs-mount-not-writable">
<h2>NFS Mount Not Writable<a class="headerlink" href="#nfs-mount-not-writable" title="Permalink to this headline">¶</a></h2>
<p>The NFS <code class="docutils literal notranslate"><span class="pre">/Users</span></code> directory is not writable as the default CoreOS VM user. So
when SSH-ed onto the CoreOS VM, it is often necessary to copy or move files
onto the <code class="docutils literal notranslate"><span class="pre">/Users</span></code> mount as root instead. This is because the default user on
the CoreOS VM has a user id that is unlikely to match the user id of the host
machine user which is needed for NFS permissions to be satisfied.</p>
<p>This is less of an issue when writing to <code class="docutils literal notranslate"><span class="pre">/Users</span></code> if it is mounted as a
volume in a running container. This is because the user under which a container
is run is typically root already.</p>
</div>
<div class="section" id="reclaiming-vm-root-disk-image-space">
<h2>Reclaiming VM Root Disk Image Space<a class="headerlink" href="#reclaiming-vm-root-disk-image-space" title="Permalink to this headline">¶</a></h2>
<p>The underlying <code class="docutils literal notranslate"><span class="pre">/</span></code> storage on the CoreOS VM is provided by a QEMU
Copy-on-write format file in <code class="docutils literal notranslate"><span class="pre">~/.rktmachine/root.qcow2</span></code>. This is a sparse
image file with a maximum size of 40Gb.</p>
<p>Over time this file grows with CoreOS VM use, e.g. new rkt containers and
builds. In the worst case this will fill the maximum allocation and result in
<code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">space</span> <span class="pre">left</span> <span class="pre">on</span> <span class="pre">device</span></code> errors.</p>
<p>The sparse image file does not automatically reduce in size, so even though you
may free up space on the image it may not be reflected in the actual size of
the image on the host device.</p>
<p>To see the current size of the root image disk, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ du -sh ~/.rktmachine/root.qcow2
2.5G        /Users/docrualaoich/.rktmachine/root.qcow2
</pre></div>
</div>
<p>To reduce this first free up space on the image from a terminal on the CoreOS
VM, e.g. by running sudo rkt gc, sudo rkt image gc, removing large files in the
user home directory.</p>
<p>Then, from the host machine, follow these instructions on how to
<a class="reference external" href="https://pve.proxmox.com/wiki/Shrink_Qcow2_Disk_Files">Shrink Qcow2 Disk Files</a>.</p>
<p>This sequence of actions requires <a class="reference external" href="http://www.qemu.org">QEMU</a> to be installed on your macOS machine.
The easiest installation is using the <a class="reference external" href="https://brew.sh">Homebrew</a> package manager. First install
that using the instructions on the Homebrew site and then run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">qemu</span>
</pre></div>
</div>
<p>Once the preliminaries are complete, begin by stopping any running CoreOS VM
using the RktMachine menubar options.</p>
<p>Change to the <code class="docutils literal notranslate"><span class="pre">~/.rktmachine</span></code> working directory for RktMachine and move the
current root disk image to a backup.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/.</span><span class="n">rktmachine</span>
<span class="n">mv</span> <span class="n">root</span><span class="o">.</span><span class="n">qcow2</span> <span class="n">root</span><span class="o">.</span><span class="n">qcow2_backup</span>
</pre></div>
</div>
<p>Then use the QEMU image tool to make a new root image from the backup. By
specifying the same sparse image type in the <code class="docutils literal notranslate"><span class="pre">-O</span></code> type argument, the
conversion will optimise the image as a side effect.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qemu</span><span class="o">-</span><span class="n">img</span> <span class="n">convert</span> <span class="o">-</span><span class="n">O</span> <span class="n">qcow2</span> <span class="n">root</span><span class="o">.</span><span class="n">qcow2_backup</span> <span class="n">root</span><span class="o">.</span><span class="n">qcow2</span>
</pre></div>
</div>
<p>The new image size can be checked and compared against the pre-shrink image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">du</span> <span class="o">-</span><span class="n">sh</span> <span class="n">root</span><span class="o">.</span><span class="n">qcow2</span><span class="o">*</span>
</pre></div>
</div>
<p>Restart the CoreOS VM using the RktMachine menu and verify that the root image
functions correctly, i.e. the VM boots and contains the same rkt containers and
user home directory files as previously.</p>
<p>Remove the <code class="docutils literal notranslate"><span class="pre">root.qcow2_backup</span></code> image when you are happy that the new image
file is not corrupt.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>