<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Releasing &#8212; RktMachine</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/woofwoofinc.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="Documentation" href="documentation.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          RktMachine</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#installing-rktmachine">Installing RktMachine</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#starting-the-rktmachine-coreos-vm">Starting the RktMachine CoreOS VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#building-a-rkt-container">Building a rkt Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#installing-and-running-rkt-containers">Installing and Running rkt Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#running-rkt-containers-interactively">Running rkt Containers Interactively</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rkt.html">Working with rkt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rkt.html#building-containers-for-rkt">Building Containers for rkt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#coreos-vm-does-not-boot">CoreOS VM Does Not Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#nfs-mount-unavailable">NFS Mount Unavailable</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#nfs-mount-not-writable">NFS Mount Not Writable</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#reclaiming-vm-root-disk-image-space">Reclaiming VM Root Disk Image Space</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-coreos">Why CoreOS?</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dev.html">Development Tools Container</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev.html#building">Building</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building</a><ul>
<li class="toctree-l2"><a class="reference internal" href="building.html#xcode">XCode</a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html#rebuilding-root-qcow2">Rebuilding <code class="docutils literal notranslate"><span class="pre">root.qcow2</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html#rebuilding-tools-qcow2">Rebuilding <code class="docutils literal notranslate"><span class="pre">tools.qcow2</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html#rebuilding-macos-corectl-binaries">Rebuilding macOS Corectl Binaries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Releasing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#release-checklist">Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-release-dmg">Building a Release DMG</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-the-github-release">Preparing the GitHub Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="#publishing-the-documentation">Publishing the Documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="conduct.html">Contributor Covenant Code of Conduct</a><ul>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#our-pledge">Our Pledge</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#our-standards">Our Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#our-responsibilities">Our Responsibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#scope">Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#enforcement">Enforcement</a></li>
<li class="toctree-l2"><a class="reference internal" href="conduct.html#attribution">Attribution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="thanks.html">Thanks</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="documentation.html" title="Previous Chapter: Documentation"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Documentation</span>
    </a>
  </li>
  <li>
    <a href="contributing.html" title="Next Chapter: Contributing"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Contributing &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="releasing">
<h1>Releasing<a class="headerlink" href="#releasing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="release-checklist">
<h2>Release Checklist<a class="headerlink" href="#release-checklist" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Check version number is correct in <code class="docutils literal notranslate"><span class="pre">Info.plist</span></code> and <code class="docutils literal notranslate"><span class="pre">docs/conf.py</span></code>.</li>
<li>Build release DMG and upload to GitHub releases.</li>
<li>Build documentation and upload to GitHub pages.</li>
</ol>
</div>
<div class="section" id="building-a-release-dmg">
<h2>Building a Release DMG<a class="headerlink" href="#building-a-release-dmg" title="Permalink to this headline">¶</a></h2>
<p>Prepare a release by building the distributable DMG disk image archive file to
contain the RktMachine binary.</p>
<p>First build an archive in Xcode by selecting <code class="docutils literal notranslate"><span class="pre">Product</span> <span class="pre">-&gt;</span> <span class="pre">Archive</span></code>. On success
this opens a listing of the previously built archives. Select the latest, i.e.
the one just created, and use the export options from the panel on the right
hand side to export the archive as a macOS app. Use the “Export App” option to
export without resigning.</p>
<p>This prompts for a location to write the exported macOS app. Change to this
directory in the terminal once it is complete. There will be a
<code class="docutils literal notranslate"><span class="pre">RktMachine.app</span></code> file present in the directory.</p>
<p>Then follow this <a class="reference external" href="http://stackoverflow.com/a/1513578">StackOverflow answer on creating DMG packages</a>.</p>
<p>Create an empty <code class="docutils literal notranslate"><span class="pre">pack.temp.dmg</span></code> to build the RktMachine distribution. Attach
the DMG file to <code class="docutils literal notranslate"><span class="pre">/Volumes</span></code> and take the device identifier from the output
information so we can reference it later.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>hdiutil create \
    -srcfolder . \
    -volname &quot;RktMachine&quot; \
    -fs HFS+ -fsargs &quot;-c c=64,a=16,e=16&quot; \
    -format UDRW \
    -megabytes 64 \
    pack.temp.dmg

device=$(
    hdiutil attach -readwrite -noverify -noautoopen &quot;pack.temp.dmg&quot; | \
        egrep &#39;^/dev/&#39; | \
        sed 1q | \
        awk &#39;{ print $1 }&#39;
)
</pre></div>
</div>
<p>Execute some AppleScript to layout the DMG appearance, let icon sizes, and
turn off toolbars, etc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;</span>
  <span class="n">tell</span> <span class="n">application</span> <span class="s2">&quot;Finder&quot;</span>
    <span class="n">tell</span> <span class="n">disk</span> <span class="s2">&quot;RktMachine&quot;</span>
      <span class="nb">open</span>
      <span class="nb">set</span> <span class="n">current</span> <span class="n">view</span> <span class="n">of</span> <span class="n">container</span> <span class="n">window</span> <span class="n">to</span> <span class="n">icon</span> <span class="n">view</span>
      <span class="nb">set</span> <span class="n">toolbar</span> <span class="n">visible</span> <span class="n">of</span> <span class="n">container</span> <span class="n">window</span> <span class="n">to</span> <span class="n">false</span>
      <span class="nb">set</span> <span class="n">statusbar</span> <span class="n">visible</span> <span class="n">of</span> <span class="n">container</span> <span class="n">window</span> <span class="n">to</span> <span class="n">false</span>
      <span class="nb">set</span> <span class="n">the</span> <span class="n">bounds</span> <span class="n">of</span> <span class="n">container</span> <span class="n">window</span> <span class="n">to</span> <span class="p">{</span><span class="mi">400</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">350</span><span class="p">}</span>
      <span class="nb">set</span> <span class="n">theViewOptions</span> <span class="n">to</span> <span class="n">the</span> <span class="n">icon</span> <span class="n">view</span> <span class="n">options</span> <span class="n">of</span> <span class="n">container</span> <span class="n">window</span>
      <span class="nb">set</span> <span class="n">arrangement</span> <span class="n">of</span> <span class="n">theViewOptions</span> <span class="n">to</span> <span class="ow">not</span> <span class="n">arranged</span>
      <span class="nb">set</span> <span class="n">icon</span> <span class="n">size</span> <span class="n">of</span> <span class="n">theViewOptions</span> <span class="n">to</span> <span class="mi">72</span>
      <span class="n">make</span> <span class="n">new</span> <span class="n">alias</span> <span class="n">file</span> <span class="n">at</span> <span class="n">container</span> <span class="n">window</span> <span class="n">to</span> <span class="n">POSIX</span> <span class="n">file</span> <span class="s2">&quot;/Applications&quot;</span> <span class="k">with</span> <span class="n">properties</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s2">&quot;Applications&quot;</span><span class="p">}</span>
      <span class="nb">set</span> <span class="n">position</span> <span class="n">of</span> <span class="n">item</span> <span class="s2">&quot;&#39;RktMachine.app&#39;&quot;</span> <span class="n">of</span> <span class="n">container</span> <span class="n">window</span> <span class="n">to</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">}</span>
      <span class="nb">set</span> <span class="n">position</span> <span class="n">of</span> <span class="n">item</span> <span class="s2">&quot;Applications&quot;</span> <span class="n">of</span> <span class="n">container</span> <span class="n">window</span> <span class="n">to</span> <span class="p">{</span><span class="mi">250</span><span class="p">,</span> <span class="mi">100</span><span class="p">}</span>
      <span class="n">close</span>
      <span class="nb">open</span>
      <span class="n">update</span> <span class="n">without</span> <span class="n">registering</span> <span class="n">applications</span>
      <span class="n">delay</span> <span class="mi">5</span>
      <span class="n">close</span>
    <span class="n">end</span> <span class="n">tell</span>
  <span class="n">end</span> <span class="n">tell</span>
<span class="s1">&#39; | osascript</span>
</pre></div>
</div>
<p>Remove write permissions from the files on the disk image and eject it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>chmod -Rf go-w /Volumes/RktMachine
sync
sync
hdiutil detach ${device}
</pre></div>
</div>
<p>Finally, convert the temporary DMG file to the final compressed format and clean
up.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hdiutil</span> <span class="n">convert</span> \
    <span class="n">pack</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">dmg</span> \
    <span class="o">-</span><span class="nb">format</span> <span class="n">UDZO</span> \
    <span class="o">-</span><span class="n">imagekey</span> <span class="n">zlib</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">9</span> \
    <span class="o">-</span><span class="n">o</span> <span class="n">RktMachine</span><span class="o">.</span><span class="n">dmg</span>

<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">pack</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">dmg</span>
</pre></div>
</div>
<p>The final DMG image is output as <code class="docutils literal notranslate"><span class="pre">RktMachine.dmg</span></code>.</p>
</div>
<div class="section" id="preparing-the-github-release">
<h2>Preparing the GitHub Release<a class="headerlink" href="#preparing-the-github-release" title="Permalink to this headline">¶</a></h2>
<p>Take the SHA256 of the <code class="docutils literal notranslate"><span class="pre">RktMachine.dmg</span></code> binary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shasum</span> <span class="o">-</span><span class="n">a</span> <span class="mi">256</span> <span class="n">RktMachine</span><span class="o">.</span><span class="n">dmg</span>
</pre></div>
</div>
<p>Then create a new RktMachine release on the <a class="reference external" href="https://github.com/woofwoofinc/rktmachine/releases">GitHub Releases</a> page. The
release should be named the same as the version number in <code class="docutils literal notranslate"><span class="pre">Info.plist</span></code>
and also be tagged with this value.</p>
<p>The release text should include the SHA256 value generated earlier. The
following is a template for the release text.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Release</span> <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span> <span class="n">of</span> <span class="n">RktMachine</span> <span class="k">for</span> <span class="n">macOS</span><span class="o">.</span>

<span class="n">sha256</span><span class="p">:</span> <span class="n">cce3abfaf7b4aa4652ccdb58a607b84a346a906685afe159ca89bac08a9b355e</span>
</pre></div>
</div>
</div>
<div class="section" id="publishing-the-documentation">
<h2>Publishing the Documentation<a class="headerlink" href="#publishing-the-documentation" title="Permalink to this headline">¶</a></h2>
<p>Project documentation is published to <a class="reference external" href="https://woofwoofinc.github.io/rktmachine">woofwoofinc.github.io/rktmachine</a>
using <a class="reference external" href="https://pages.github.com">GitHub Pages</a>.</p>
<p>First build the documentation as described in <a class="reference internal" href="documentation.html#documentation"><span class="std std-ref">Documentation</span></a>.</p>
<p>The GitHub configuration for this project is to serve documentation from the
<code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch. Rather than attempt to build a new <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> in the
current repository, it is simpler to copy the repository, change to <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code>
in the repository copy, and clean everything from there. This has the advantage
of not operating in the current repository too so it is non-destructive.</p>
<p>Create a copy of the repository.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="n">rktmachine</span> <span class="n">rktmachine</span><span class="o">-</span><span class="n">gh</span><span class="o">-</span><span class="n">pages</span>
</pre></div>
</div>
<p>Then change into the new repository and swap to the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pushd</span> <span class="n">rktmachine</span><span class="o">-</span><span class="n">gh</span><span class="o">-</span><span class="n">pages</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span>
</pre></div>
</div>
<p>Clear out everything in the branch. This uses dot globing and extended glob
options to arrange deletion of everything except the .git directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>shopt -s dotglob
shopt -s extglob
rm -fr !(.git)

shopt -u extglob
shopt -u dotglob
</pre></div>
</div>
<p>Next, copy in the contents of <code class="docutils literal notranslate"><span class="pre">docs/_build/html</span></code> from the main project
repository. This is the latest build of the documentation. Dot globing is
used again since the dot files in the <code class="docutils literal notranslate"><span class="pre">docs/_build/html</span></code> directory are also
needed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shopt</span> <span class="o">-</span><span class="n">s</span> <span class="n">dotglob</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">../</span><span class="n">rktmachine</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">html</span><span class="o">/*</span> <span class="o">.</span>

<span class="n">shopt</span> <span class="o">-</span><span class="n">u</span> <span class="n">dotglob</span>
</pre></div>
</div>
<p>Commit the documentation and push the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch to GitHub.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="o">-</span><span class="n">A</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Add latest documentation.&quot;</span>
<span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span>
</pre></div>
</div>
<p>Then clean up the temporary repository.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">popd</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">fr</span> <span class="n">rktmachine</span><span class="o">-</span><span class="n">gh</span><span class="o">-</span><span class="n">pages</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>